parameters:
  - name: buildProfile
    type: object
  - name: jobName
    type: string
    default: StaticCodeAnalysis
  - name: displayName
    type: string
    default: Static Code Analysis
  - name: dependsOn
    type: object
    default: []
  - name: mandatoryTasks
    type: stepList
    default: []

jobs:
  - job: ${{ parameters.jobName }}
    displayName: ${{ parameters.displayName }}
    dependsOn:
      - ${{ each dependency in parameters.dependsOn }}:
          - ${{ dependency }}
    steps:
      - ${{ parameters.mandatoryTasks }}

      - checkout: self
        path: s
        persistCredentials: true

      - script: |
          echo export scripts path..
        displayName: Export Scripts Path

      - script: |
          echo installing node 18.0.0..
        displayName: Install Node 18.0.0

      - script: |
          echo npm install..
        displayName: npm install

      - ${{ if eq(parameters.buildProfile.name, 'mvn-plugins') }}:
          - script: |
              echo linting proxy bundle..
            displayName: "SCA: Proxy Bundle"

          - ${{ if eq(parameters.buildProfile.type, 'api-proxies') }}:
              - script: |
                  echo linting js resources..
                displayName: "SCA: JavScript Resources"

      - script: |
          echo consuming sca results..
        displayName: Consume SCA Results

      - script: |
          echo cleaning artifacts..
        displayName: Artifacts Cleaning

      # - ${{ parameters.mandatoryTasks }}

      # - template: ../steps/export-scripts-path.yaml

      # - checkout: self
      #   path: s
      #   persistCredentials: true

      # - task: NodeTool@0
      #   displayName: Install Node 18.0.0
      #   inputs:
      #     versionSpec: 18.0.0

      # - task: Npm@1
      #   displayName: npm install
      #   inputs:
      #     command: install

      # - task: Bash@3
      #   displayName: "SCA: Proxy Bundle"
      #   inputs:
      #     filePath: $(Framework.Config.PathToScripts)/apigeelint-scan.sh

      # - task: Bash@3
      #   displayName: "SCA: JavaScript Resources"
      #   inputs:
      #     filePath: $(Framework.Config.PathToScripts)/eslint-scan.sh

      # - task: PublishTestResults@2
      #   displayName: Consume SCA Results
      #   condition: always()
      #   inputs:
      #     testResultsFormat: JUnit
      #     testResultsFiles: "**/*.xml"
      #     searchFolder: $(Build.ArtifactStagingDirectory)/sca
      #     failTaskOnFailedTests: true

      # - task: Bash@3
      #   displayName: Artifacts Cleaning
      #   condition: always()
      #   inputs:
      #     filePath: $(Framework.Config.PathToScripts)/clean-artifact.sh
      #     arguments: -a sca
